<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend Debug Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß Backend Debug Tool</h1>
    
    <div class="test-section info">
        <h3>üéØ Problem: Backend returns empty array but CoinGecko has data</h3>
        <p>Let's test your backend step by step:</p>
    </div>

    <div class="test-section">
        <h3>1Ô∏è‚É£ Test Your Backend Endpoint</h3>
        <button onclick="testBackend()">Test http://localhost:8080/api/price-history/bitcoin</button>
        <div id="backend-result"></div>
    </div>

    <div class="test-section">
        <h3>2Ô∏è‚É£ Test CoinGecko Directly</h3>
        <button onclick="testCoinGecko()">Test CoinGecko API Directly</button>
        <div id="coingecko-result"></div>
    </div>

    <div class="test-section">
        <h3>3Ô∏è‚É£ Compare Results</h3>
        <button onclick="compareResults()">Compare Backend vs CoinGecko</button>
        <div id="compare-result"></div>
    </div>

    <script>
        async function testBackend() {
            const resultDiv = document.getElementById('backend-result');
            resultDiv.innerHTML = '<p>Testing your backend...</p>';
            
            try {
                const response = await fetch('http://localhost:8080/api/price-history/bitcoin');
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="${Array.isArray(data) && data.length > 0 ? 'success' : 'error'}">
                        <h4>${Array.isArray(data) && data.length > 0 ? '‚úÖ' : '‚ùå'} Backend Response</h4>
                        <p>Status: ${response.status}</p>
                        <p>Data type: ${Array.isArray(data) ? 'Array' : typeof data}</p>
                        <p>Data length: ${Array.isArray(data) ? data.length : 'N/A'}</p>
                        <p>First 3 items:</p>
                        <pre>${JSON.stringify(data.slice(0, 3), null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Backend Error</h4>
                        <p>Error: ${error.message}</p>
                        <p>Make sure your Spring Boot backend is running on port 8080</p>
                    </div>
                `;
            }
        }

        async function testCoinGecko() {
            const resultDiv = document.getElementById('coingecko-result');
            resultDiv.innerHTML = '<p>Testing CoinGecko API...</p>';
            
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=90&interval=daily');
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <h4>‚úÖ CoinGecko Response</h4>
                        <p>Status: ${response.status}</p>
                        <p>Has prices: ${data.prices ? 'Yes' : 'No'}</p>
                        <p>Prices length: ${data.prices ? data.prices.length : 'N/A'}</p>
                        <p>First 3 price points:</p>
                        <pre>${JSON.stringify(data.prices ? data.prices.slice(0, 3) : 'No prices', null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå CoinGecko Error</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        async function compareResults() {
            const resultDiv = document.getElementById('compare-result');
            resultDiv.innerHTML = '<p>Comparing results...</p>';
            
            try {
                // Test backend
                const backendResponse = await fetch('http://localhost:8080/api/price-history/bitcoin');
                const backendData = await backendResponse.json();
                
                // Test CoinGecko
                const coingeckoResponse = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=90&interval=daily');
                const coingeckoData = await coingeckoResponse.json();
                
                const backendHasData = Array.isArray(backendData) && backendData.length > 0;
                const coingeckoHasData = coingeckoData.prices && coingeckoData.prices.length > 0;
                
                resultDiv.innerHTML = `
                    <div class="${backendHasData && coingeckoHasData ? 'success' : 'error'}">
                        <h4>üìä Comparison Results</h4>
                        <p><strong>CoinGecko:</strong> ${coingeckoHasData ? '‚úÖ Has data' : '‚ùå No data'} (${coingeckoData.prices ? coingeckoData.prices.length : 0} points)</p>
                        <p><strong>Your Backend:</strong> ${backendHasData ? '‚úÖ Has data' : '‚ùå No data'} (${backendData.length} points)</p>
                        
                        ${!backendHasData && coingeckoHasData ? `
                            <div class="error">
                                <h4>üö® PROBLEM IDENTIFIED!</h4>
                                <p>CoinGecko has data but your backend doesn't!</p>
                                <p>This means your PriceHistoryService.java is not properly extracting the 'prices' array.</p>
                                <p><strong>Solution:</strong> Check your backend code for:</p>
                                <ul>
                                    <li>Proper extraction of 'prices' from CoinGecko response</li>
                                    <li>Correct data transformation</li>
                                    <li>Error handling</li>
                                </ul>
                            </div>
                        ` : ''}
                        
                        ${backendHasData && coingeckoHasData ? `
                            <div class="success">
                                <h4>‚úÖ Everything Working!</h4>
                                <p>Both CoinGecko and your backend have data.</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Comparison Error</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Auto-run tests
        window.onload = function() {
            testBackend();
            setTimeout(testCoinGecko, 1000);
            setTimeout(compareResults, 2000);
        };
    </script>
</body>
</html> 